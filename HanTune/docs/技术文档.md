# 汉兜 (Handle) - 汉字版 Wordle 技术文档

## 项目概述

汉兜是一个基于汉字的 Wordle 猜词游戏，玩家需要在10次机会内猜出当天的四字成语。项目采用现代化的前端技术栈，支持拼音、注音、双拼三种输入模式，具有完整的游戏逻辑、状态管理和数据统计功能。

## 技术架构

### 核心技术栈
- **前端框架**: Vue 3 + Composition API
- **构建工具**: Vite 4.x
- **样式方案**: UnoCSS (原子化CSS框架)
- **状态管理**: VueUse + LocalStorage
- **类型系统**: TypeScript
- **图标系统**: Iconify
- **动画效果**: Canvas Confetti

### 开发工具链
- **包管理**: pnpm + workspace
- **代码规范**: ESLint (Anthony Fu配置)
- **测试框架**: Vitest
- **部署平台**: Netlify Functions

## 项目结构

```
src/
├── components/          # Vue组件
│   ├── AppName.vue      # 应用名称组件
│   ├── CharBlock.vue    # 单字符块组件（核心UI）
│   ├── WordBlocks.vue   # 单词块容器组件
│   ├── Play.vue         # 游戏主界面
│   ├── Navbar.vue       # 导航栏
│   ├── Settings.vue     # 设置面板
│   ├── Dashboard.vue    # 数据统计面板
│   ├── Hint.vue         # 提示组件
│   ├── CheatSheet.vue   # 拼音对照表
│   ├── Share*.vue       # 分享相关组件
│   └── Modal*.vue       # 模态框组件
├── logic/               # 核心游戏逻辑
│   ├── types.ts         # TypeScript类型定义
│   ├── constants.ts     # 游戏常量
│   ├── utils.ts         # 工具函数（拼音解析、匹配算法）
│   ├── idioms.ts        # 成语数据管理
│   └── check.ts         # 输入验证逻辑
├── data/                # 静态数据
│   ├── idioms.txt       # 成语列表（49304条）
│   ├── polyphones.json  # 多音字映射
│   └── new.txt          # 待添加成语
├── answers/             # 答案管理
│   ├── list.ts          # 历史答案列表
│   └── index.ts         # 答案获取逻辑
├── locales/             # 国际化
│   ├── zh-cn.json       # 简体中文
│   └── zh-tw.json       # 繁体中文
├── styles/              # 样式文件
│   └── main.css         # 主样式
├── state.ts             # 全局状态管理
├── storage.ts           # 本地存储管理
├── i18n.ts              # 国际化配置
└── main.ts              # 应用入口
```

## 核心功能模块

### 1. 游戏逻辑模块 (logic/)

#### 类型定义 (types.ts)
```typescript
interface ParsedChar {
  char: string      // 汉字字符
  _1: string       // 声母/第一个拼音部分
  _2?: string      // 韵母/第二个拼音部分  
  _3?: string      // 第三个拼音部分（双拼）
  parts: string[]   // 所有拼音部分
  yin: string      // 完整拼音
  tone: number     // 声调（1-4）
}

interface MatchResult {
  char: MatchType   // 汉字匹配结果
  _1: MatchType    // 声母匹配结果
  _2: MatchType    // 韵母匹配结果
  _3: MatchType    // 第三部分匹配结果
  tone: MatchType  // 声调匹配结果
}

type MatchType = 'exact' | 'misplaced' | 'none' | 'deleted'
```

#### 拼音解析算法 (utils.ts)
- **parsePinyin()**: 根据输入模式（拼音/注音/双拼）解析拼音字符串
- **parseChar()**: 将单个汉字解析为ParsedChar对象
- **parseWord()**: 将整个成语解析为ParsedChar数组
- **testAnswer()**: 核心匹配算法，返回每个字符的匹配状态

#### 匹配算法详解
1. **汉字匹配**: 完全匹配为'exact'，存在但位置错误为'misplaced'，不存在为'none'
2. **拼音部分匹配**: 声母、韵母、声调分别独立判断
3. **多音字处理**: 优先使用答案中的正确读音
4. **颜色反馈**: 绿色(exact)、橙色(misplaced)、灰色(none)、删除线(deleted)

### 2. 状态管理模块

#### 全局状态 (state.ts)
```typescript
// 核心状态
const answer = computed(() => getAnswerOfDay(dayNo.value))  // 当日答案
const isPassed = computed(() => /* 判断是否通过 */)
const isFailed = computed(() => /* 判断是否失败 */)
const isFinished = computed(() => isPassed.value || isFailed.value)

// 游戏状态
const tries = computed<string[]>(/* 用户尝试记录 */)
const parsedTries = computed(() => /* 解析后的尝试 */)
```

#### 本地存储 (storage.ts)
- **历史记录**: 每日游戏结果和统计
- **用户设置**: 输入模式、颜色主题、严格模式等
- **游戏进度**: 当前尝试、提示使用、用时统计

### 3. UI组件系统

#### CharBlock组件 - 核心UI元素
- **多模式支持**: 拼音/注音/双拼三种显示模式
- **动态样式**: 根据匹配结果显示不同颜色和效果
- **音标显示**: 支持声调符号和数字标记
- **响应式布局**: 自适应不同屏幕尺寸

#### WordBlocks组件 - 单词容器
- **翻转动画**: 3D翻转效果显示结果
- **状态管理**: 处理revealed、active等状态
- **批量渲染**: 高效渲染多个字符块

### 4. 输入系统

#### 输入模式支持
1. **拼音模式**: 标准汉语拼音
2. **注音模式**: 台湾注音符号
3. **双拼模式**: 搜狗双拼方案

#### 输入验证
- **字符过滤**: 只接受中文字符
- **成语验证**: 检查是否为有效成语（严格模式）
- **长度限制**: 固定4个字符

## 数据管理

### 成语数据库
- **idioms.txt**: 49304条成语，每行一个
- **polyphones.json**: 特殊发音的多音字映射
- **数据更新**: 支持从汉典网站自动抓取新成语

### 答案系统
- **每日答案**: 基于日期生成固定答案
- **历史答案**: 存储2022年1月1日以来的所有答案
- **随机选择**: 超出范围时随机选择历史答案

## 特色功能

### 1. 多语言支持
- **简体中文**: 大陆用户界面
- **繁体中文**: 台湾用户界面
- **自动检测**: 根据浏览器语言自动选择

### 2. 辅助功能
- **提示系统**: 显示答案中的一个字符
- **拼音对照表**: 快速查看拼音对应关系
- **输入辅助**: 实时显示已用/未用的拼音部分

### 3. 数据统计
- **游戏统计**: 总游戏数、通过率、平均用时
- **每日统计**: 当日完成人数、平均尝试次数
- **历史记录**: 详细的每日游戏历史

### 4. 分享功能
- **结果分享**: 生成emoji格式的游戏结果
- **图片分享**: 生成精美的分享图片
- **文本分享**: 纯文本格式的游戏总结

## 性能优化

### 1. 代码分割
- **按需加载**: 组件和逻辑按需加载
- **chunk优化**: 手动分割vendor、locale、idioms等chunk

### 2. 缓存策略
- **本地缓存**: 游戏状态和用户设置持久化
- **数据预加载**: 成语数据提前加载和缓存

### 3. 渲染优化
- **虚拟滚动**: 大量数据展示时优化性能
- **防抖处理**: 输入和状态更新添加防抖

## 部署和构建

### 构建配置
- **Vite配置**: 支持别名解析、自动导入、组件注册
- **UnoCSS配置**: 自定义颜色、快捷方式、响应式规则
- **TypeScript**: 完整的类型检查和定义

### 部署方案
- **Netlify**: 主站部署，支持边缘函数
- **静态生成**: 纯前端应用，无需后端服务
- **CDN加速**: 全球分发，快速访问

## 扩展性设计

### 1. 模块化架构
- **逻辑分离**: 游戏逻辑、UI组件、数据管理清晰分离
- **插件化**: 支持新的输入模式和验证规则
- **主题系统**: 支持自定义颜色和样式

### 2. 数据驱动
- **配置化**: 游戏常量、规则可配置
- **数据源**: 支持多种成语数据源
- **国际化**: 易于添加新的语言支持

## 技术亮点

1. **TypeScript全栈**: 从数据到UI完整的类型安全
2. **现代化工具链**: Vite + pnpm + UnoCSS的高效开发体验
3. **响应式设计**: 完美适配移动端和桌面端
4. **无障碍支持**: 语义化HTML和键盘导航
5. **性能优化**: 代码分割、懒加载、缓存策略
6. **用户体验**: 流畅动画、即时反馈、智能提示

这份技术文档涵盖了汉兜项目的完整技术架构和实现细节，可以作为项目理解和复制的完整参考。