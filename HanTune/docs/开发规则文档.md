# 汉兜二次开发规则文档

## 开发原则

### 1. 代码复用优先
- **90%复用原则**: 优先复用现有稳定代码，避免重复开发
- **渐进式改造**: 先确保基础功能正常，再逐步添加新功能
- **最小化修改**: 仅修改必要的代码，保持系统稳定性

### 2. 模块化设计
- **功能分离**: 每日模式和无尽模式状态完全分离
- **单一职责**: 每个模块只负责一个核心功能
- **接口统一**: 新增模块遵循现有接口规范

### 3. 用户体验一致性
- **视觉统一**: 保持现有UI风格和交互模式
- **操作流畅**: 模式切换响应时间 < 500ms
- **错误友好**: 提供清晰的错误提示和处理

## 代码规范

### TypeScript规范
```typescript
// ✅ 正确：明确的类型定义
export type GameMode = 'daily' | 'endless'
export interface EndlessState {
  round: number
  word: string
  isFinished: boolean
}

// ❌ 错误：使用any类型
const gameData: any = {}
```

### Vue组件规范
```vue
<!-- ✅ 正确：使用Composition API -->
<script setup lang="ts">
import { ref, computed } from 'vue'
import type { GameMode } from '~/logic/mode'

const currentMode = ref<GameMode>('daily')
const isDailyMode = computed(() => currentMode.value === 'daily')
</script>

<!-- ❌ 错误：混用Options API -->
<script>
export default {
  data() {
    return { mode: 'daily' }
  }
}
</script>
```

### 样式规范
```vue
<!-- ✅ 正确：使用UnoCSS原子类 -->
<div class="flex items-center justify-center p-4 bg-white dark:bg-gray-800">

<!-- ❌ 错误：内联样式 -->
<div style="display: flex; padding: 16px;">
```

## 文件组织规范

### 目录结构
```
src/
├── components/          # Vue组件
│   ├── GameModeSelector.vue    # 新增：模式选择
│   ├── Play.vue               # 修改：游戏主组件
│   └── ...                    # 复用：其他组件
├── logic/               # 业务逻辑
│   ├── mode.ts          # 新增：模式管理
│   ├── endless.ts       # 新增：无尽模式
│   ├── randomIdiom.ts   # 新增：随机成语
│   └── ...              # 复用：其他逻辑
└── ...
```

### 命名规范
- **组件文件**: PascalCase (GameModeSelector.vue)
- **逻辑文件**: camelCase (randomIdiom.ts)
- **变量函数**: camelCase (currentMode, switchMode)
- **常量**: UPPER_SNAKE_CASE (GAME_MODES)
- **类型接口**: PascalCase (GameMode, EndlessState)

## 开发流程规范

### 1. 任务执行顺序
按照优先级严格执行：
1. **High优先级**: 核心功能模块（模式管理、无尽引擎等）
2. **Medium优先级**: UI组件和界面修改
3. **Low优先级**: 功能优化和细节调整

### 2. 代码提交规范
每完成一个任务立即标记为完成：
- 功能完整实现后才标记完成
- 遇到错误或阻塞保持in_progress状态
- 创建新任务描述需要解决的问题

### 3. 测试验证规范
- **单元测试**: 每个新增模块都要验证核心功能
- **集成测试**: 模式切换和状态管理必须测试
- **用户体验测试**: 界面响应性和交互流畅度

## 质量标准

### 功能质量
- [ ] 模式选择界面正常显示和切换
- [ ] 每日一题模式保持原有功能不变
- [ ] 无尽模式支持连续挑战和轮次管理
- [ ] 严格模式完全移除，无残留代码
- [ ] 分享功能只保留必要选项

### 性能质量
- [ ] 模式切换响应时间 < 500ms
- [ ] 成语加载时间 < 1s
- [ ] 界面渲染流畅，无明显卡顿
- [ ] 内存使用稳定，无泄漏问题

### 代码质量
- [ ] TypeScript类型检查无错误
- [ ] ESLint代码规范检查通过
- [ ] 组件结构清晰，逻辑分离
- [ ] 注释完整，便于维护

## 风险控制

### 高风险操作
1. **状态管理修改**: 必须确保不同模式状态正确隔离
2. **核心逻辑修改**: 成语验证等核心功能谨慎修改
3. **存储逻辑调整**: 确保数据兼容性和迁移安全

### 风险应对策略
1. **备份机制**: 修改前备份关键文件
2. **渐进测试**: 每个模块完成后立即测试
3. **回滚准备**: 保持代码版本控制，支持快速回滚

## 验收标准

### 最终验收清单
- [ ] 所有任务清单项目完成
- [ ] 功能演示通过用户验收
- [ ] 性能指标达到预期要求
- [ ] 代码质量通过审查标准
- [ ] 文档更新完整准确

### 交付物清单
- [ ] 完整的源代码实现
- [ ] 功能演示和测试报告
- [ ] 部署和运行说明
- [ ] 后续维护建议

## 注意事项

### 开发过程中
1. **严格按照任务清单执行**，不跳跃或遗漏任务
2. **及时更新任务状态**，保持进度透明
3. **遇到问题立即记录**，不隐瞒技术难点
4. **保持代码整洁**，及时清理调试代码

### 完成后
1. **全面功能测试**，确保所有模式正常工作
2. **性能基准测试**，验证响应时间要求
3. **用户体验验证**，确保交互流畅自然
4. **文档同步更新**，保持文档与代码一致

这份规则文档将指导整个二次开发过程，确保高质量交付。