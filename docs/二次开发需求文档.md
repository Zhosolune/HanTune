# 汉兜二次开发需求文档

## 项目背景
基于现有的汉兜（汉字版Wordle）项目进行定制化开发，在 `HanTune` 目录下创建新的版本，主要改动包括游戏模式选择、无尽模式添加、严格模式移除等。

## 需求清单

### 需求1 - 移除严格模式
**用户故事：** 作为玩家，我不需要严格模式限制，希望能够输入任意四字词语进行游戏

#### 验收标准
1. When 用户在游戏设置中时，the 系统 shall 不显示严格模式开关
2. When 用户输入任意四字词语时，the 系统 shall 接受输入不再验证是否为成语
3. While 游戏运行时，the 系统 shall 完全移除严格模式相关的验证逻辑

### 需求2 - 添加主界面游戏模式选择
**用户故事：** 作为玩家，我希望能够在开始游戏前选择不同的游戏模式

#### 验收标准
1. When 用户访问应用时，the 系统 shall 首先显示游戏模式选择界面
2. When 用户点击"每日一题"时，the 系统 shall 进入现有的每日挑战模式
3. When 用户点击"无尽模式"时，the 系统 shall 进入新的无尽挑战模式
4. While 模式选择界面显示时，the 系统 shall 提供清晰的模式说明和视觉区分

### 需求3 - 无尽模式功能
**用户故事：** 作为玩家，在无尽模式中我希望能够连续挑战多个成语

#### 验收标准
1. When 用户成功猜出成语后，the 系统 shall 显示"再来一词"按钮
2. When 用户点击"再来一词"时，the 系统 shall 生成新的随机成语开始新一轮
3. While 无尽模式中，the 系统 shall 不限制每日只能玩一次
4. When 新一轮游戏开始时，the 系统 shall 重置所有游戏状态（尝试次数、输入等）

### 需求4 - 保持每日一题模式
**用户故事：** 作为玩家，我仍然希望体验原有的每日挑战模式

#### 验收标准
1. When 用户选择每日一题模式时，the 系统 shall 保持现有的游戏逻辑不变
2. While 每日一题模式中，the 系统 shall 维持每日一次的游戏限制
3. When 用户完成每日挑战后，the 系统 shall 显示倒计时直到下一天的挑战

### 需求5 - 分享功能优化
**用户故事：** 作为玩家，我希望分享功能更加简洁，去除不必要的社交媒体选项

#### 验收标准
1. When 用户点击分享按钮时，the 系统 shall 只显示复制链接和生成图片选项
2. While 分享界面显示时，the 系统 shall 不显示微博和推特分享按钮
3. When 用户选择复制链接时，the 系统 shall 生成当前游戏结果的分享链接

## 技术架构设计

### 整体架构
基于现有Vue 3 + Vite + UnoCSS技术栈，采用状态驱动的页面切换模式，不引入额外的路由库。

```
HanTune/
├── src/
│   ├── components/
│   │   ├── GameModeSelector.vue    # 新增：模式选择主界面
│   │   ├── Play.vue               # 修改：支持无尽模式重玩
│   │   ├── ShareDialog.vue        # 修改：移除社交媒体分享
│   │   └── Settings.vue           # 修改：移除严格模式选项
│   ├── logic/
│   │   ├── constants.ts           # 修改：移除严格模式常量
│   │   └── utils.ts               # 修改：调整成语验证逻辑
│   ├── state.ts                   # 修改：添加游戏模式状态
│   ├── storage.ts                 # 修改：调整存储逻辑
│   └── App.vue                    # 修改：支持模式切换
```

### 状态管理设计

#### 新增状态
```typescript
// 游戏模式：'daily' | 'endless'
const gameMode = ref<'daily' | 'endless'>('daily')

// 无尽模式专用状态
const endlessRound = ref(0)           // 当前轮数
const endlessWord = ref('')           // 当前成语
const isEndlessMode = computed(() => gameMode.value === 'endless')
```

#### 模式切换逻辑
- 每日模式：使用现有的dayNo和answer系统
- 无尽模式：使用独立的随机成语生成器

### 组件修改方案

#### 1. App.vue 修改
- 添加模式选择状态判断
- 根据模式渲染不同界面
- 处理模式切换逻辑

#### 2. GameModeSelector.vue 新增
- 两个模式卡片：每日一题、无尽模式
- 模式说明和视觉设计
- 模式选择事件处理

#### 3. Play.vue 修改
- 添加"再来一词"按钮（仅无尽模式）
- 处理无尽模式的新轮次开始
- 调整游戏结束逻辑

#### 4. 分享相关组件修改
- 移除微博、推特分享选项
- 保留复制链接和图片生成功能
- 简化分享界面布局

### 数据管理调整

#### 成语生成
```typescript
// 无尽模式随机成语生成
function getRandomIdiom(): string {
  const idioms = /* 从idioms.txt加载所有成语 */
  const randomIndex = Math.floor(Math.random() * idioms.length)
  return idioms[randomIndex]
}
```

#### 存储逻辑
- 每日模式：保持现有存储逻辑
- 无尽模式：不记录到历史统计，仅保存当前进度

## 开发计划

### 第一阶段：基础架构调整
1. 创建项目基础结构
2. 修改状态管理系统
3. 调整App.vue主入口

### 第二阶段：模式选择界面
1. 创建GameModeSelector组件
2. 设计模式选择UI
3. 实现模式切换逻辑

### 第三阶段：无尽模式开发
1. 修改Play组件支持重玩
2. 实现随机成语生成
3. 调整游戏状态管理

### 第四阶段：功能优化
1. 移除严格模式相关代码
2. 优化分享功能
3. 测试和调试

### 第五阶段：测试和优化
1. 功能完整性测试
2. 用户体验优化
3. 性能优化和代码清理

## 技术风险和对策

### 风险1：状态管理复杂性
**问题**：两种模式的状态可能产生冲突
**对策**：严格分离两种模式的状态，使用computed属性进行模式判断

### 风险2：成语数据加载
**问题**：无尽模式需要完整的成语数据
**对策**：异步加载idioms.txt数据，添加加载状态提示

### 风险3：用户体验一致性
**问题**：两种模式的用户体验需要保持一致
**对策**：统一UI组件和交互逻辑，确保视觉和操作上的一致性

## 验收标准

### 功能验收
- [ ] 主界面显示两个游戏模式选项
- [ ] 每日一题模式保持原有功能
- [ ] 无尽模式支持连续挑战
- [ ] 严格模式完全移除
- [ ] 分享功能只保留必要选项

### 性能验收
- [ ] 模式切换响应时间 < 200ms
- [ ] 成语加载时间 < 1s
- [ ] 界面渲染流畅，无卡顿

### 用户体验验收
- [ ] 界面美观，操作直观
- [ ] 模式切换无缝衔接
- [ ] 错误处理完善
- [ ] 移动端适配良好

这份需求文档将作为二次开发的指导文档，确保项目按计划高质量完成。