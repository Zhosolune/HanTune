# 汉兜二次开发实施计划

## 项目概述
基于现有汉字版Wordle项目进行二次开发，添加游戏模式选择功能，支持每日一题和无尽模式，同时优化用户体验。

## 任务清单

### 阶段一：基础架构改造
- [ ] 1.1 删除严格模式相关代码
  - 移除所有`useStrict`相关逻辑
  - 清理严格模式下的特殊处理
  - 简化状态管理逻辑

- [ ] 1.2 创建模式管理模块
  - 新建`src/logic/mode.ts`文件
  - 实现模式切换逻辑
  - 添加模式状态管理

- [ ] 1.3 创建无尽模式引擎
  - 新建`src/logic/endless.ts`文件
  - 实现随机成语生成逻辑
  - 添加轮次管理功能

### 阶段二：数据层改造
- [ ] 2.1 创建随机成语生成器
  - 新建`src/logic/randomIdiom.ts`文件
  - 实现成语数据加载和缓存
  - 添加去重和批量生成功能

- [ ] 2.2 修改成语数据源
  - 整理现有成语数据
  - 确保数据格式一致性
  - 优化数据加载性能

### 阶段三：界面层开发
- [ ] 3.1 创建模式选择组件
  - 新建`src/components/GameModeSelector.vue`
  - 设计模式选择界面
  - 实现模式切换交互

- [ ] 3.2 修改主应用组件
  - 更新`src/App.vue`
  - 添加模式选择逻辑
  - 实现条件渲染

- [ ] 3.3 修改游戏主组件
  - 更新`src/components/Play.vue`
  - 添加无尽模式支持
  - 实现再来一词功能

### 阶段四：分享功能优化
- [ ] 4.1 修改分享组件
  - 移除微博和推特分享选项
  - 保留微信和复制链接功能
  - 优化分享文案

- [ ] 4.2 更新分享逻辑
  - 适配不同模式的分享内容
  - 添加模式标识

### 阶段五：集成测试
- [ ] 5.1 功能集成测试
  - 测试模式切换流程
  - 验证无尽模式逻辑
  - 检查数据一致性

- [ ] 5.2 用户体验测试
  - 界面响应性测试
  - 交互流畅度测试
  - 错误处理测试

- [ ] 5.3 性能优化
  - 代码分割优化
  - 懒加载实现
  - 内存泄漏检查

## 详细实施步骤

### 第一步：环境准备
```bash
# 确保项目环境正常
cd e:\myProjects_Trae\Wordle\handle-main
npm install
npm run dev
```

### 第二步：删除严格模式
**目标文件**: `src/storage.ts`
```typescript
// 删除以下相关代码
const strictMode = useStorage('hanziwordle-strict', false)
export const useStrict = computed(() => strictMode.value)
```

**目标文件**: `src/components/Play.vue`
```vue
<!-- 删除严格模式相关模板 -->
<!-- 删除严格模式切换按钮 -->
```

### 第三步：创建核心逻辑模块

#### 3.1 模式管理 (`src/logic/mode.ts`)
```typescript
import { ref, computed } from 'vue'

export type GameMode = 'daily' | 'endless'

const currentMode = ref<GameMode>('daily')

export function switchMode(mode: GameMode) {
  currentMode.value = mode
}

export const isDailyMode = computed(() => currentMode.value === 'daily')
export const isEndlessMode = computed(() => currentMode.value === 'endless')

export const currentGameMode = computed(() => currentMode.value)
```

#### 3.2 无尽模式引擎 (`src/logic/endless.ts`)
```typescript
import { ref, computed } from 'vue'
import { getRandomIdiom } from './randomIdiom'

// 状态定义
const endlessRound = ref(1)
const currentWord = ref('')
const currentTries = ref<string[]>([])
const isRoundFinished = ref(false)

// 计算属性
export const endlessState = computed(() => ({
  round: endlessRound.value,
  word: currentWord.value,
  tries: currentTries.value,
  isFinished: isRoundFinished.value
}))

// 初始化函数
export function initEndlessMode() {
  startNewRound()
}

// 开始新轮次
export function startNewRound() {
  currentWord.value = getRandomIdiom()
  currentTries.value = []
  isRoundFinished.value = false
  endlessRound.value++
}

// 添加尝试
export function addEndlessTry(word: string) {
  currentTries.value.push(word)
  if (word === currentWord.value) {
    isRoundFinished.value = true
  }
}

// 重置函数
export function resetEndlessState() {
  endlessRound.value = 1
  currentWord.value = ''
  currentTries.value = []
  isRoundFinished.value = false
}
```

#### 3.3 随机成语生成器 (`src/logic/randomIdiom.ts`)
```typescript
// 基于现有idioms.ts进行扩展
import { getAnswerOfDay } from '../answers'

let usedIdioms = new Set<string>()

export function getRandomIdiom(): string {
  // 获取所有可用成语
  const allIdioms = getAllAvailableIdioms()
  
  // 过滤已使用的成语
  const availableIdioms = allIdioms.filter(idiom => !usedIdioms.has(idiom))
  
  // 如果所有成语都用完了，重置使用记录
  if (availableIdioms.length === 0) {
    usedIdioms.clear()
    return getRandomIdiom()
  }
  
  // 随机选择一个成语
  const randomIndex = Math.floor(Math.random() * availableIdioms.length)
  const selectedIdiom = availableIdioms[randomIndex]
  
  // 记录已使用
  usedIdioms.add(selectedIdiom)
  
  return selectedIdiom
}

function getAllAvailableIdioms(): string[] {
  // 基于现有成语数据生成可用列表
  // 这里需要访问现有的成语数据源
  return []
}
```

### 第四步：界面组件开发

#### 4.1 模式选择组件
```vue
<!-- src/components/GameModeSelector.vue -->
<template>
  <div class="mode-selector min-h-screen flex items-center justify-center">
    <div class="mode-cards grid grid-cols-1 md:grid-cols-2 gap-8 max-w-4xl mx-auto p-8">
      
      <!-- 每日一题模式 -->
      <div class="mode-card daily-card cursor-pointer" @click="selectMode('daily')">
        <div class="card-icon text-6xl mb-4">📅</div>
        <h2 class="text-2xl font-bold mb-2">每日一题</h2>
        <p class="text-gray-600 mb-6">每天一个成语，与全球玩家同步挑战</p>
        <div class="features space-y-2">
          <div class="feature flex items-center">
            <span class="mr-2">✓</span>
            <span>每日更新</span>
          </div>
          <div class="feature flex items-center">
            <span class="mr-2">✓</span>
            <span>全球同步</span>
          </div>
          <div class="feature flex items-center">
            <span class="mr-2">✓</span>
            <span>历史记录</span>
          </div>
        </div>
      </div>
      
      <!-- 无尽模式 -->
      <div class="mode-card endless-card cursor-pointer" @click="selectMode('endless')">
        <div class="card-icon text-6xl mb-4">♾️</div>
        <h2 class="text-2xl font-bold mb-2">无尽模式</h2>
        <p class="text-gray-600 mb-6">连续挑战，不断突破自我极限</p>
        <div class="features space-y-2">
          <div class="feature flex items-center">
            <span class="mr-2">✓</span>
            <span>无限挑战</span>
          </div>
          <div class="feature flex items-center">
            <span class="mr-2">✓</span>
            <span>即时反馈</span>
          </div>
          <div class="feature flex items-center">
            <span class="mr-2">✓</span>
            <span>连续记录</span>
          </div>
        </div>
      </div>
    </div>
  </div>
</template>

<script setup lang="ts">
import { defineEmits } from 'vue'
import { switchMode } from '~/logic/mode'

const emit = defineEmits<{
  modeSelected: [mode: 'daily' | 'endless']
}>()

function selectMode(mode: 'daily' | 'endless') {
  switchMode(mode)
  emit('modeSelected', mode)
}
</script>

<style scoped>
.mode-card {
  @apply bg-white dark:bg-gray-800 rounded-xl p-8 shadow-lg hover:shadow-xl transition-all duration-300 border-2 border-transparent hover:border-primary;
}

.daily-card:hover {
  @apply border-blue-500;
}

.endless-card:hover {
  @apply border-green-500;
}
</style>
```

#### 4.2 主应用组件修改
```vue
<!-- App.vue 修改部分 -->
<template>
  <main font-sans text="center gray-700 dark:gray-300" select-none>
    <!-- 模式选择 -->
    <GameModeSelector 
      v-if="!modeSelected" 
      @mode-selected="handleModeSelected" 
    />
    
    <!-- 游戏内容 -->
    <template v-else>
      <NotTodayBanner v-if="dayNo < daySince && isDailyMode" />
      <Navbar />
      <div p="4">
        <NoQuizToday v-if="!answer.word && isDailyMode" />
        <NoFuturePlay v-else-if="dayNo > daySince && !isDev && isDailyMode" />
        <NoPastPlay v-else-if="daySince - dayNo > DAYS_PLAY_BACK && !isDev && isDailyMode" />
        <Play v-else :mode="currentMode" @round-complete="handleRoundComplete" />
      </div>
      <ModalsLayer />
      <Confetti />
    </template>
  </main>
</template>

<script setup lang="ts">
// 新增导入
import { ref } from 'vue'
import { currentMode, isDailyMode } from '~/logic/mode'
import { initEndlessMode } from '~/logic/endless'

// 新增状态
const modeSelected = ref(false)

// 新增方法
function handleModeSelected(mode: 'daily' | 'endless') {
  modeSelected.value = true
  if (mode === 'endless') {
    initEndlessMode()
  }
}

function handleRoundComplete() {
  // 处理轮次完成逻辑
}
</script>
```

### 第五步：分享功能修改

#### 5.1 分享组件修改
```vue
<!-- ShareButton.vue 修改部分 -->
<template>
  <div class="share-buttons">
    <!-- 保留微信分享 -->
    <button v-if="wechat" @click="shareToWechat" class="share-btn wechat">
      微信分享
    </button>
    
    <!-- 保留复制链接 -->
    <button @click="copyLink" class="share-btn copy">
      复制链接
    </button>
    
    <!-- 删除微博和推特分享 -->
    <!--
    <button v-if="weibo" @click="shareToWeibo" class="share-btn weibo">
      微博分享
    </button>
    <button v-if="twitter" @click="shareToTwitter" class="share-btn twitter">
      推特分享
    </button>
    -->
  </div>
</template>

<script setup lang="ts">
// 删除微博和推特相关方法
// const shareToWeibo = () => { ... }
// const shareToTwitter = () => { ... }
</script>
```

## 时间安排

### 第一周：基础改造
- 第1-2天：删除严格模式，测试现有功能
- 第3-4天：创建模式管理和无尽模式引擎
- 第5-7天：实现随机成语生成器

### 第二周：界面开发
- 第1-3天：开发模式选择组件
- 第4-5天：修改主应用组件
- 第6-7天：修改游戏主组件

### 第三周：功能完善
- 第1-2天：优化分享功能
- 第3-5天：集成测试和bug修复
- 第6-7天：性能优化和代码清理

## 风险评估与应对

### 技术风险
1. **成语数据不足**：实现循环使用机制
2. **性能问题**：采用懒加载和缓存策略
3. **状态管理复杂**：使用清晰的状态分层

### 时间风险
1. **任务延期**：预留缓冲时间，优先核心功能
2. **测试不充分**：增加自动化测试覆盖率

### 质量风险
1. **用户体验不佳**：多轮用户测试和反馈收集
2. **兼容性问题**：跨浏览器和设备测试

## 验收标准

### 功能验收
- [ ] 模式选择界面正常显示和切换
- [ ] 每日一题模式保持原有功能
- [ ] 无尽模式支持连续挑战
- [ ] 再来一词功能正常工作
- [ ] 分享功能只显示微信和复制链接

### 性能验收
- [ ] 模式切换响应时间 < 500ms
- [ ] 成语加载时间 < 1s
- [ ] 界面渲染流畅，无卡顿

### 用户体验验收
- [ ] 界面美观，交互流畅
- [ ] 错误提示清晰友好
- [ ] 移动端适配良好

## 后续优化

### 短期优化（1个月内）
- 添加更多成语数据
- 优化随机算法避免重复
- 增加游戏统计功能

### 长期规划（3个月内）
- 添加更多游戏模式
- 实现用户系统
- 添加社交功能

这份实施计划为二次开发提供了详细的执行指南和时间安排。